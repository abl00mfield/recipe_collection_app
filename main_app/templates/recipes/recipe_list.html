{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/recipe-list.css' %}">
<title>Recipe List</title>
{% endblock%}

{% block content %}
<h2>All Recipes</h2>

{% if recipes %}
    <div class="recipe-list">
        {% for recipe in recipes %}
        <div class="recipe-card">
            <a href="{% url 'recipe_detail' recipe.id %}">
                <h3>{{ recipe.title }}</h3>
                <p>by {{ recipe.author.username }}</p>

                {% if recipe.photo %}
                <div class="recipe-thumb-container">
                    <img src="{{ recipe.photo.url }}" alt="{{ recipe.title }}" class ="recipe-thumb">
                </div>
                {% endif %}

                <p>{{ recipe.description|truncatewords:20 }}</p>
                {% if user.is_authenticated %}
            </a>
            <form 
                action="{% url 'collection_add_recipe' recipe.id %}" 
                method=POST
                class="add-to-collection-form" 
            >
                {% csrf_token %}
                <select 
                    name="collection_id" 
                    class="collection-select"
                    data-recipe-id="{{ recipe.id }}"
                    required>
                    <option value="" disabled selected>Add to collection</option>
                    {% for collection in user_collections %}
                    <option value="{{ collection.id }}">{{ collection.name }}</option>
                    {% endfor %}
                    <option value="__new__">+ New Collection</option>
                </select>
                <button type="submit" class = "btn">âž•</button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    </div>
{% else %}
    <p>No recipes yet. Be the first to add one!</p>
{% endif %}

<div id="new-collection-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <form method="POST" action="{% url 'collection_create_inline' %}">
        {% csrf_token %}
        <label for="new-collection-name">New collection name:</label>
        <input type="text" id="new-collection-name" name="name" required>
        <input type="hidden" id="new-collection-recipe-id" name="recipe_id">
        <div class="modal-buttons">
          <button type="submit" class="btn">Create</button>
          <button type="button" id="cancel-modal" class="btn danger-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

{% endblock %}

<!-- templates/registration/login.html -->

